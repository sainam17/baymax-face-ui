<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BayMax Control Panel</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            user-select: none;
            -webkit-user-select: none;
            background: #1a1a2e;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .control-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 12px;
            color: white;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .control-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
        }

        .control-btn:active {
            transform: translateY(0);
        }

        .active-expression {
            outline: 3px solid #fff;
            outline-offset: 2px;
        }
    </style>
</head>

<body class="h-screen flex items-center justify-center">

    <div class="bg-gray-800 bg-opacity-90 rounded-3xl p-10 shadow-2xl max-w-lg w-full mx-4">
        <h2 class="text-white text-center mb-2 text-2xl font-bold">ğŸ¤– BayMax Control Panel</h2>
        <p class="text-gray-400 text-center mb-8 text-sm">Select an expression for the robot face</p>

        <div class="flex gap-4 flex-wrap justify-center">
            <button id="btn-idle" onclick="sendExpression('idle')"
                class="control-btn bg-blue-500 hover:bg-blue-600 active-expression">
                ğŸ˜ Idle
            </button>
            <button id="btn-happy" onclick="sendExpression('happy')"
                class="control-btn bg-green-500 hover:bg-green-600">
                ğŸ˜Š Happy
            </button>
            <button id="btn-thinking" onclick="sendExpression('thinking')"
                class="control-btn bg-purple-500 hover:bg-purple-600">
                ğŸ¤” Thinking
            </button>
            <button id="btn-scanning" onclick="sendExpression('scanning')"
                class="control-btn bg-yellow-500 hover:bg-yellow-600">
                ğŸ‘€ Scanning
            </button>
            <button id="btn-talking" onclick="sendExpression('talking')"
                class="control-btn bg-pink-500 hover:bg-pink-600">
                ğŸ—£ï¸ Talking
            </button>
            <button id="btn-surprised" onclick="sendExpression('surprised')"
                class="control-btn bg-red-500 hover:bg-red-600">
                ğŸ˜² Surprised
            </button>
            <button id="btn-warning" onclick="sendExpression('warning')"
                class="control-btn bg-orange-600 hover:bg-orange-700">
                âš ï¸ Warning
            </button>
        </div>

        <div class="mt-6 flex justify-center">
            <button onclick="sendBlink()" class="control-btn bg-gray-600 hover:bg-gray-700">
                ğŸ˜‰ Blink
            </button>
        </div>

        <div id="status" class="text-gray-500 text-center mt-6 text-xs">
            Current: <span id="currentExpression" class="text-white font-semibold">idle</span>
        </div>

        <!-- Head Direction D-Pad -->
        <div class="mt-8 border-t border-gray-700 pt-6">
            <h3 class="text-gray-300 text-center mb-4 text-sm font-semibold">ğŸ® Head Direction</h3>
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 4px; width: 180px; margin: 0 auto;">
                <button onmousedown="sendDirection('up-left')" onmouseup="releaseDirection()"
                    class="control-btn bg-gray-600 hover:bg-gray-700 py-2 text-lg">â†–</button>
                <button onmousedown="sendDirection('up')" onmouseup="releaseDirection()"
                    class="control-btn bg-gray-600 hover:bg-gray-700 py-2 text-lg">â¬†</button>
                <button onmousedown="sendDirection('up-right')" onmouseup="releaseDirection()"
                    class="control-btn bg-gray-600 hover:bg-gray-700 py-2 text-lg">â†—</button>
                <button onmousedown="sendDirection('left')" onmouseup="releaseDirection()"
                    class="control-btn bg-gray-600 hover:bg-gray-700 py-2 text-lg">â¬…</button>
                <button onmousedown="sendDirection('center')"
                    class="control-btn bg-gray-500 hover:bg-gray-600 py-2 text-xs">â—</button>
                <button onmousedown="sendDirection('right')" onmouseup="releaseDirection()"
                    class="control-btn bg-gray-600 hover:bg-gray-700 py-2 text-lg">â¡</button>
                <button onmousedown="sendDirection('down-left')" onmouseup="releaseDirection()"
                    class="control-btn bg-gray-600 hover:bg-gray-700 py-2 text-lg">â†™</button>
                <button onmousedown="sendDirection('down')" onmouseup="releaseDirection()"
                    class="control-btn bg-gray-600 hover:bg-gray-700 py-2 text-lg">â¬‡</button>
                <button onmousedown="sendDirection('down-right')" onmouseup="releaseDirection()"
                    class="control-btn bg-gray-600 hover:bg-gray-700 py-2 text-lg">â†˜</button>
            </div>
            <div class="text-gray-500 text-center mt-3 text-xs">
                Direction: <span id="directionStatus" class="text-white font-semibold">center</span>
            </div>
        </div>
    </div>

    <script>
        const { ipcRenderer } = require('electron');

        let currentActive = 'idle';

        function sendExpression(expression) {
            ipcRenderer.send('set-expression', expression);
            updateActiveButton(expression);
        }

        function sendBlink() {
            ipcRenderer.send('blink');
        }

        function updateActiveButton(expression) {
            // Remove active class from all buttons
            document.querySelectorAll('.control-btn').forEach(btn => {
                btn.classList.remove('active-expression');
            });

            // Add active class to the selected button
            const activeBtn = document.getElementById(`btn-${expression}`);
            if (activeBtn) {
                activeBtn.classList.add('active-expression');
            }

            // Update status text
            document.getElementById('currentExpression').textContent = expression;
            currentActive = expression;
        }

        // ===== Head Direction Controls =====
        function sendDirection(direction) {
            ipcRenderer.send('head-direction', direction);
            document.getElementById('directionStatus').textContent = direction;
        }

        function releaseDirection() {
            ipcRenderer.send('head-direction', 'center');
            document.getElementById('directionStatus').textContent = 'center';
        }

        // Keyboard arrow support
        document.addEventListener('keydown', (e) => {
            const map = { ArrowUp: 'up', ArrowDown: 'down', ArrowLeft: 'left', ArrowRight: 'right' };
            if (map[e.key] && !e.repeat) sendDirection(map[e.key]);
        });
        document.addEventListener('keyup', (e) => {
            const map = ['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'];
            if (map.includes(e.key)) releaseDirection();
        });
    </script>
</body>

</html>